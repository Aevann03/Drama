{% extends "default.html" %}


{% set ups=p.upvotes %}
{% set downs=p.downvotes %}
{% set score=ups-downs %}

{% if v %}
{% set voted=p.voted if p.voted else 0 %}
{% else %}
{% set voted=-2 %}
{% endif %}

{% block title %}

{% include "/submission/SubmissionAwards.html" %}

<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js"></script>
<script src="/assets/js/new_comments_count.js?v=53"></script>

{% if v and (v.id == p.author_id or v.admin_level == 6 and v.id in [1,28,995,2513]) %}
<script>		
	togglePostEdit=function(id){

		body=document.getElementById("post-body");
		title=document.getElementById("post-title");
		form=document.getElementById("edit-post-body-"+id);
		box=document.getElementById("post-edit-box-"+id);

		body.classList.toggle("hidden");
		title.classList.toggle("hidden");
		form.classList.toggle("hidden");
		autoExpand(box);
	};
</script>
{% endif %}


{% if 'rama' not in request.host %}
<script>
	function poll_vote(cid) {
		{% if v %}
		var type = document.getElementById(cid).checked;
		var scoretext = document.getElementById('poll-' + cid);
		var score = Number(scoretext.textContent);
		if (type == true) scoretext.textContent = score + 1;
		else scoretext.textContent = score - 1;
		post('/vote/poll/' + cid + '?vote=' + type);
		{% else %}
		var myToast = new bootstrap.Toast(document.getElementById('toast-post-error'));
		myToast.show();
		document.getElementById('toast-post-error-text').innerText = "Only logged-in users can vote!";
		{% endif %}
	}
</script>

{% if v %}
<script src="/assets/js/comments_v.js?v=65"></script>
{% include "award_modal.html" %}
{% include "emoji_modal.html" %}
{% include "gif_modal.html" %}
{% if v.admin_level == 6 %}
{% include "ban_modal.html" %}
{% endif %}
{% endif %}
{% include "expanded_image_modal.html" %}
{% endif %}

{% if p.award_count("shit") %}
<script src="/assets/js/bugs.js?v=54"></script>
{% set minbugs = 10*p.award_count("shit") if p.award_count("shit") < 3 else 20 %}
{% set maxbugs = 20*p.award_count("shit") if p.award_count("shit") < 3 else 40 %}
<script>
	new BugController({
		imageSprite: "/assets/images/fly-sprite.gif",
		canDie: false,
		minBugs: {{minbugs}},
		maxBugs: {{maxbugs}},
		mouseOver: "multiply"
	});
</script>
{% endif %}


{% if p.award_count("fireflies") %}
<script src="/assets/js/fireflies.js?v=54"></script>
{% set minbugs = 10*p.award_count("fireflies") if p.award_count("fireflies") < 3 else 20 %}
{% set maxbugs = 20*p.award_count("fireflies") if p.award_count("fireflies") < 3 else 40 %}
<script>
	new BugController({
		imageSprite: "/assets/images/fireflies.gif",
		canDie: false,
		minBugs: {{minbugs}},
		maxBugs: {{maxbugs}},
		mouseOver: "multiply"
	});
</script>
{% endif %}


<meta charset="utf-8" >
<meta property="og:type" content="article" >

{% if comment_info and not comment_info.is_banned and not linked_comment.deleted_utc > 0 %}
<title>{{'@'+comment_info.author.username}} comments on "{{p.plaintitle(v)}} - {{'SITE_NAME' | app_config}}"</title>


<meta property="og:article:author" content="{{'@'+comment_info.author.username}}" >
<meta property="article:published_time" content="{{comment_info.created_datetime}}" >
{% if comment_info.edited_utc %}<meta property="article:modified_time" content="{{comment_info.edited_string}}" >{% endif %}
<meta property="og:description" name="description" content="{{comment_info.plainbody(v)}}" >
<meta property="og:author" name="author" content="{{'@'+comment_info.author.username}}" >
<meta property="og:title" content="{{'@'+comment_info.author.username}} comments on {{p.plaintitle(v)}} - {{'SITE_NAME' | app_config}}" >
<meta property="og:image" content="{% if p.is_image %}{{p.realurl(v)}}{% elif p.has_thumb%}{{p.thumb_url}}{% else %}{{'SITE_NAME' | app_config}}/assets/images/{{'SITE_NAME' | app_config}}/preview.gif{% endif %}" >
{% if p.url and p.url.lower().endswith('.mp4') %}
<meta property="og:video" content="{{ p.realurl(v) }}" >
{% endif %}
<meta property="og:url" content="{{comment_info.permalink | full_link}}" >
<meta property="og:site_name" content="{{request.host}}" >

<meta name="twitter:card" content="summary" >
<meta name="twitter:site" content="{{request.host_url}}">
<meta name="twitter:title" content="{{'@'+comment_info.author.username}} comments on {{p.plaintitle(v)}} - {{'SITE_NAME' | app_config}}" >
<meta name="twitter:creator" content="{{'@'+comment_info.author.username}}">
<meta name="twitter:description" content="{{comment_info.plainbody(v)}}" >
<meta name="twitter:image" content="{% if p.is_image %}{{p.realurl(v)}}{% elif p.has_thumb%}{{p.thumb_url}}{% else %}{{'SITE_NAME' | app_config}}/assets/images/{{'SITE_NAME' | app_config}}/preview.gif{% endif %}" >
<meta name="twitter:url" content="{{p.permalink | full_link}}" >

{% if linked_comment.author.is_private %}
<meta name="robots" content="noindex">
{% endif %}

{% else %}
<title>{{p.plaintitle(v)}} - {{'SITE_NAME' | app_config}}</title>


{% if p.author %}<meta property="og:article:author" content="{{'@'+p.author.username}}">{% endif %}
<meta property="article:published_time" content="{{p.created_datetime}}" >
{% if p.edited_utc %}<meta property="article:modified_time" content="{{p.edited_string}}" >{% endif %}
<meta property="og:description" name="description" content="{{p.plainbody(v)}}" >
{% if p.author %}<meta property="og:author" name="author" content="{{'@'+p.author.username}}" >{% endif %}
<meta property="og:title" content="{{p.plaintitle(v)}} - {{'SITE_NAME' | app_config}}" >
<meta property="og:image" content="{% if p.is_image %}{{p.realurl(v)}}{% elif p.has_thumb%}{{p.thumb_url}}{% else %}{{'SITE_NAME' | app_config}}/assets/images/{{'SITE_NAME' | app_config}}/preview.gif{% endif %}" >
{% if p.url and p.url.lower().endswith('.mp4') %}
<meta property="og:video" content="{{ p.realurl(v) }}" >
{% endif %}
<meta property="og:url" content="{{p.permalink | full_link}}" >
<meta property="og:site_name" content="{{request.host}}" >

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="{{request.host_url}}">
<meta name="twitter:title" content="{{p.plaintitle(v)}} - {{'SITE_NAME' | app_config}}" >
{% if p.author %}<meta name="twitter:creator" content="{{'@'+p.author.username}}">{% endif %}
<meta name="twitter:description" content="{{p.plainbody(v)}}" >
<meta name="twitter:image" content="{% if p.is_image %}{{p.realurl(v)}}{% elif p.has_thumb %}{{p.thumb_url}}{% else %}{{'SITE_NAME' | app_config}}/assets/images/{{'SITE_NAME' | app_config}}/preview.gif{% endif %}" >
<meta name="twitter:url" content="{{p.permalink | full_link}}" >

{% if p.author.is_private %}
<meta name="robots" content="noindex">
{% endif %}

{% endif %}
{% endblock %}

{% block pagetype %}thread{% endblock %}

{% block actionsModal %}

<div style="display:none" id="popover-{{p.id}}">
	<div class="popover-user-profile" role="tooltip">
		<img class="w-100 h-64 object-cover" src="{{p.author.banner_url}}">
		<div class="d-flex align-items-end px-3 mt-n6 mb-3">
			<img class="avatar-72 rounded img-thumbnail shadow-sm" src="{{p.author.profile_url}}">
			<div class="px-3 text-truncate">
				<h5 class="text-truncate text-black">{{p.author.username}}</h5>
			</div>
		</div>
		<div class="px-3">
			<span class="popover-bio text-black">{% if p.author.bio_html %}{{p.author.bio_html_eager | safe}}{% endif %}</span>
		</div>
		<div class="border-top d-flex align-items-center p-3 gap-3 smol">
			<span>
				<strong class="text-black">{{p.author.post_count}}</strong>
				<span class="text-black">posts</span>
			</span>
			<span class="ml-3">
				<strong class="text-black">{{p.author.comment_count}}</strong>
				<span class="text-black">comments</span>
			</span>
			<span class="ml-3">
				<strong class="text-black">{{p.author.coins}}</strong>
				<span class="text-black">coins</span>
			</span>  
			&nbsp;&nbsp;&nbsp;&nbsp;
			<a {% if v %}href="{{p.author.url}}"{% else %}href="/logged_out{{p.author.url}}"{% endif %} target="_blank" class="ml-auto text-decoration-none">
				View
				<i class="fas fa-arrow-right fa-sm px-1"></i>
			</a>
		</div>
	</div>
</div>

{% include "/modals/ModalSubmissionActions.html" %}

{% endblock %}

{% block subHeader %}
<div class="col-span-full">
	<div class="bg-gray-800">
		test
	</div>
</div>
{% endblock %}

{% block content %}

<div class="col-span-full xl:col-span-9">

<!-- Post -->
<div id="post-root" class="col-span-full sm:py-4 my-2.5 sm:my-0">

	<div id="post-{{p.id}}" class="w-full {% if p.is_banned %}bg-red-900{% endif %}{% if voted==1 %}upvoted{% elif voted==-1 %}downvoted{% endif %}">
		<div class="{% if p.deleted_utc > 0 %}deleted {% endif %} flex flex-row-reverse flex-nowrap justify-end">

			{% if not p.is_image and p.thumb_url and not p.embed_url %}
			<div class="hidden md:block pl-3">
				<a rel="nofollow noopener noreferrer" href="{{p.realurl(v)}}" {% if not v or v.newtabexternal %}target="_blank"{% endif %}>
					<img loading="lazy" src="{{p.thumb_url}}" class="w-36 h-20 object-cover shadow-md rounded-sm" alt="Unable to load image">
				</a>
			</div>
			{% endif %}

			<div class="w-full">
				<!-- Content -->
				<div id="post-content" class="{% if p.deleted_utc > 0 %}deleted {% endif %}card-block w-100 my-md-auto">

					{% if p.active_flags %}
					<div id="flaggers" class="flaggers hidden">
						<strong><i class="far fa-fw fa-flag"></i> Reported by:</strong>
						<pre></pre>
						<ul style="padding-left:20px; margin-bottom: 0;">
							{% for f in p.ordered_flags %}
							<li><a style="font-weight:bold" href="{{f.user.url}}">{{f.user.username}}</a>{% if f.reason %}: {{f.reason | safe}}{% endif %} {% if v.admin_level==6 %}<a href="javascript:void(0)" onclick="post_toast('/del_report/p{{ f.id }}')">[remove]</a>{% endif %}</li>
							{% endfor %}
						</ul>
					</div>
					{% endif %}

					<!-- Meta information -->
					<div class="flex items-center space-x-1 mb-1 text-sm text-gray-500 leading-normal">
						{% if v and v.admin_level==6 and p.author.shadowbanned %}
						<i class="fas fa-user-times text-admin" data-bs-toggle="tooltip" data-bs-placement="bottom" title="" data-bs-original-title="Shadowbanned by @{{p.author.shadowbanned}}"></i>
						{% endif %}
						{% if p.distinguish_level %}
						<i class="fas fa-broom text-admin" data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-original-title="{{'SITE_NAME' | app_config}} Admin, speaking officially"></i>
						{% endif %}
						{% if p.is_bot %}
						<i class="fad fa-robot text-info" data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-original-title="Bot"></i>
						{% endif %}
						{% if p.author.verified %}
						<i class="fas fa-badge-check align-middle ml-1" style="color:{% if p.author.verifiedcolor %}#{{p.author.verifiedcolor}}{% else %}#1DA1F2{% endif %}" data-bs-toggle="tooltip" data-bs-placement="bottom" title="" data-bs-original-title="{{p.author.verified}}"></i>
						{% endif %}
						<a class="flex items-center" data-bs-placement="bottom" data-bs-toggle="popover" data-bs-trigger="focus" data-content-id="popover-{{p.id}}" href="javascript:void(0)" tabindex="0" style="color: #{{p.author.namecolor}}; font-weight: bold;" class="user-name">
							<span {% if p.author.patron and not p.distinguish_level %}class="font-heading patron" style="background-color:#{{p.author.namecolor}};"{% elif p.distinguish_level and 'rama' in request.host %}class="mod"{% endif %}>
								{{p.author.username}}
							</span>
						</a>

						{% if p.author.customtitle %}
						<bdi style="color: #{{p.author.titlecolor}}">
							{% if p.author.quadrant %}
								<img loading="lazy" height="20" src="/assets/images/PCM/quadrants/{{p.author.quadrant}}.gif">
							{% endif %}
							{{p.author.customtitle | safe}}
						</bdi>
						{% endif %}

						<span data-bs-toggle="tooltip" data-bs-placement="bottom" id="timestamp">{{p.age_string}}</span>

						{% if p.realurl(v) %}
						<a href="/search/posts/?q=domain%3A{{p.domain}}&sort=new&t=all" {% if not v or v.newtabexternal %}target="_blank"{% endif %}>({{p.domain}})
						</a>
						{% else %}
						<span>(text post)</span>
						{% endif %}

						{% if p.edited_utc %}
						Edited
						<span data-bs-toggle="tooltip" data-bs-placement="bottom" id="edited_timestamp">{{p.edited_string}}</span>
						{% endif %}
						<span>{{p.views}} views</span>
					</div>

					<!-- Title -->
					{% if p.realurl(v) %}
					<h1 id="post-title" class="font-bold font-heading text-lg md:text-2xl leading-normal mb-2">
						<a {% if not v or v.newtabexternal %}target="_blank"{% endif %} rel="nofollow noopener noreferrer" href="{{p.realurl(v)}}">
							{% if p.club %}
								<span class="patron font-bolder mr-1" style="background-color:red; font-size:10px; line-height:2;">COUNTRY CLUB</span>
							{% endif %}
							{{p.realtitle(v) | safe}}
						</a>
					</h1>					
					{% else %}
					<h1 id="post-title" class="font-bold font-heading text-lg md:text-2xl leading-normal mb-2">
						{% if p.club %}<span class="patron font-bolder mr-1" style="background-color:red; font-size:10px; line-height:2;">COUNTRY CLUB</span>{% endif %}
						{{p.realtitle(v) | safe}}
					</h1>
					{% endif %}

					<!-- Body content -->
					<div id="post-body" class="post-body mb-3">
						{% if p.realurl(v) %}
						{% if "streamable.com/" in p.realurl(v) %}
						<div style="width: 100%; height: 0px; position: relative; padding-bottom: 56.250%;"><iframe loading="lazy" src="{{p.realurl(v)}}" frameborder="0" width="100%" height="100%" allowfullscreen="" style="width: 100%; height: 100%; position: absolute;"></iframe></div>
						<pre></pre>
						{% elif "spotify.com/" in p.realurl(v) %}
						{% if "spotify.com/embed/" in p.realurl(v) %}
						{% set streamurl=p.realurl(v) %}
						{% else %}
						{% set streamurl=p.realurl(v).replace("spotify.com", "spotify.com/embed") %}
						{% endif %}
						<iframe loading="lazy" src="{{streamurl}}" width="100%" height="160" frameBorder="0" allowtransparency="true" allow="encrypted-media"></iframe>
						<pre></pre>

						{% elif not p.embed_url and not p.is_image and not (p.url and p.url.lower().endswith('.mp4')) %}
						<a rel="nofollow noopener noreferrer" href="{{p.realurl(v)}}" {% if not v or v.newtabexternal %}target="_blank"{% endif %}>
							<div class="d-flex md:hidden justify-content-between align-items-center border rounded p-2{% if p.realbody(v) %} mb-3{% endif %}">
								<span>{{p.domain|truncate(30, True)}}</span>
								<i class="fas fa-external-link-alt text-small"></i>
							</div>
						</a>
						{% endif %}
						{% endif %}
						<div id="post-text">
							{% if p.is_image %}
							<div class="row no-gutters">
								<div class="col">
									<a {% if not v or v.newtabexternal %}target="_blank"{% endif %} rel="nofollow noopener noreferrer" href="{{p.realurl(v)}}">
										<img loading="lazy" src="{{p.realurl(v)}}" class="img-fluid" style="max-height:500px;" alt="Unable to load image">
									</a>
								</div>
							</div>
							<pre></pre>
							{% elif p.url and p.url.lower().endswith('.mp4') %}
							<div class="row no-gutters">
								<div class="col">
									<video controls loop preload="metadata" style="max-width: 100%">
										<source src="{{ p.realurl(v) }}" type="video/mp4">
										</video>
									</div>
								</div>
								<pre></pre>
								{% endif %}
								{{p.realbody(v) | safe}}

								{% for c in p.options %}
								<div class="custom-control">								
									<input type="checkbox" class="custom-control-input" id="{{c.id}}" name="option" {% if c.poll_voted(v) %}checked{% endif %} onchange="poll_vote('{{c.id}}')">
									<label class="custom-control-label" for="{{c.id}}">{{c.body_html | safe}} - <a href="/votes?link=t3_{{c.id}}"><span id="poll-{{c.id}}">{{c.upvotes}}</span> votes</a></label>
								</div>
								{% endfor %}

								{% if p.is_banned and p.ban_reason %}
								<div class="text-removed mb-0">removed by @{{p.ban_reason}}</div>
								{% endif %}




							</div>

							{% if p.embed_url %}
							{% if p.domain == "twitter.com" and (v and v.theme.split("_")[0] in ["light", "coffee", "4chan"]) %}
							{% include "embeds/twitterlight.html" %}
							{% elif "twitter.com" in p.domain %}
							{% include "embeds/twitter.html" %}
							{% elif "youtu" in p.domain %}
							{% include "embeds/youtube.html" %}
							{% endif %}
							{% endif %}
						</div>

						{% if v and (v.id==p.author_id or v.admin_level==6 and v.id in [1,28,995,2513]) and not v.is_suspended %}
						<div id="edit-post-body-{{p.id}}" class="hidden comment-write collapsed child">
							<form id="post-edit-form-{{p.id}}" class="d-flex flex-column input-group" action="/edit_post/{{p.id}}" method="post">
								<input type="hidden" name="formkey" value="{{v.formkey}}">
								<input type="hidden" name="current_page" value="{{request.path}}">
								<input name="title" class="shadow-inner rounded mb-2 p-2 bg-gray-800 border border-gray-700 border-dashed text-gray-200" required placeholder="title" value="{{p.title}}" >
								<textarea name="body" maxlength="10000" id="post-edit-box-{{p.id}}" form="post-edit-form-{{p.id}}" class="comment-box shadow-inner rounded p-2 bg-gray-800 border border-gray-700 border-dashed text-gray-200" aria-label="With textarea" placeholder="Add text to your post..." rows="10">{{p.body}}</textarea> 
								<div class="flex justify-between mt-2"> 
									<small class="format pl-0"><i class="fas fa-bold" aria-hidden="true" onclick="makeBold('post-edit-box-{{p.id}}')" data-bs-toggle="tooltip" data-bs-placement="bottom" title="" data-bs-original-title="Bold"></i></small> 
									<a class="format" href="javascript:void(0)"><i class="fas fa-italic" aria-hidden="true" onclick="makeItalics('post-edit-box-{{p.id}}')" data-bs-toggle="tooltip" data-bs-placement="bottom" title="" data-bs-original-title="Italicize"></i></a> 
									<a class="format" href="javascript:void(0)"><i class="fas fa-quote-right" aria-hidden="true" onclick="makeQuote('post-edit-box-{{p.id}}')" data-bs-toggle="tooltip" data-bs-placement="bottom" title="" data-bs-original-title="Quote"></i></a>
									<a class="format" href="javascript:void(0)"><span class="font-weight-bolder text-uppercase" onclick="commentForm('post-edit-box-{{p.id}}');getGif()" aria-hidden="true" data-bs-toggle="modal" data-bs-target="#gifModal" data-bs-toggle="tooltip" data-bs-placement="bottom"  title="" data-bs-original-title="Add GIF">GIF</span></a>
									<a class="format" href="javascript:void(0)"><i class="fas fa-smile-beam" onclick="loadEmojis('post-edit-box-{{p.id}}')" aria-hidden="true" data-bs-toggle="modal" data-bs-target="#emojiModal" data-bs-toggle="tooltip" data-bs-placement="bottom"  title="" data-bs-original-title="Add Emoji"></i></a>
									<small class="format hidden"><i class="fas fa-link" aria-hidden="true"></i></small> 
									<button type="button" onclick="togglePostEdit('{{p.id}}')" class="ml-auto px-4 py-2 rounded font-bold text-white text-sm text-shadow">
										Cancel
									</button> 
									<button form="post-edit-form-{{p.id}}" class="ml-2 px-4 py-2 rounded font-bold text-white text-sm text-shadow bg-gradient-to-t from-pink-700 to-pink-500 border border-pink-600">
										Save changes
									</button>
								</div>
							</form>
							<div class="form-text text-small p-0 m-0"><a href="/formatting" target="_blank">Formatting help</a></div>
						</div>
						{% endif %}

						{% if p.embed_url and "http" not in p.embed_url %}
						<div id="crosspost-embed">
							<div class="row no-gutters">
								<div id="frontpage" class="col-12 pt-0">
									<div class="posts" id="posts">
										{{ p.embed_url | post_embed(v) | safe }}
									</div>
								</div>
							</div>
						</div>
						{% endif %}

					</div>

					<!-- Post actions -->
					<div class="hidden md:block col-span-full pt-4">
						{% include "/submission/SubmissionActions.html" %}
					</div>

				</div>

				<!-- Author avatar, post score, and voting buttons -->
				<div class="flex flex-col items-center mr-4">

					<img src="{{p.author.profile_url}}" class="flex-shrink-0 w-16 h-16 object-cover rounded-sm mb-2" alt="author avatar"/>

					{% if v %}
					<div id="voting" class="shadow-inner shadow-md rounded-md flex flex-col mb-1 py-2 items-center w-16 border-opacity-40 border border-gray-700 bg-gray-800 text-gray-500">
						<!-- <button id="post-{{p.id}}-up" tabindex="0" onclick="vote('post', '{{p.id}}', '1')" class="mx-auto arrow-up upvote-button post-{{p.id}}-up {% if voted==1 %}active{% endif %}"></button> -->
						<span id="post-score-{{p.id}}" class="font-bold text-lg post-score-{{p.id}} {% if voted==1 %}score-up{% elif voted==-1%}score-down{% endif %}" data-bs-toggle="tooltip" data-bs-placement="right" title="" data-bs-original-title="+{{ups}} | -{{downs}}">{{score}}</span>
						<!-- <div {% if environ.get('DISABLE_DOWNVOTES') == '1' %}style="display:None!important"{% endif %} id="post-{{p.id}}-down" tabindex="0" href="javascript:void(0)" onclick="vote('post', '{{p.id}}', '-1')" class="text-muted mx-auto arrow-down downvote-button post-{{p.id}}-down {% if voted==-1 %}active{% endif %}"></div> -->
					</div>

					<button id="post-{{p.id}}-up" class="flex items-center justify-center text-xs font-bold mb-1 rounded-md w-full border p-1 border-gray-800 post-{{p.id}}-up text-gray-500 hover:text-pink-500 focus:text-pink-500" onclick="vote('post', '{{p.id}}', '1')">
						+&nbsp;<i class="fas fa-heart fa-sm fa-fw pl-1"></i>
					</button>

					{% if environ.get('DISABLE_DOWNVOTES') != '1' %}
					<button id="post-{{p.id}}-down" class="text-gray-600 text-center text-xs post-{{p.id}}-down {% if voted==-1 %}active{% endif %}" onclick="vote('post', '{{p.id}}', '-1')">
						Dislike
					</button>
					{% endif %}

					{% else %}
					<!-- Logged out score -->
					<div id="voting" class="shadow-inner shadow-md rounded-md flex flex-col mb-1 py-2 items-center w-16 border-opacity-40 border border-gray-700 bg-gray-800 text-gray-500">
						<span id="post-score-{{p.id}}" class="font-bold text-lg post-score-{{p.id}}" data-bs-toggle="tooltip" data-bs-placement="right" title="" data-bs-original-title="+{{ups}} | -{{downs}}">{{score}}</span>
					</div>
					<!-- Logged out upvote (links to login) -->
					<button id="post-{{p.id}}-up" class="flex items-center justify-center text-xs font-bold mb-1 rounded-md w-full border p-1 border-gray-800 post-{{p.id}}-up text-gray-500 hover:text-pink-500 focus:text-pink-500" onclick="location.href='/login?redirect={{request.path | urlencode}}';">
						+&nbsp;<i class="fas fa-heart fa-sm fa-fw pl-1"></i>
					</button>
					<!-- Logged out downvote (links to login) -->
					{% if environ.get('DISABLE_DOWNVOTES') != '1' %}
					<button id="post-{{p.id}}-down" class="text-gray-600 text-center text-xs post-{{p.id}}-down" onclick="location.href='/login?redirect={{request.path | urlencode}}';">
						Dislike
					</button>
					{% endif %}

					{% endif %}

				</div>

			</div>

		</div>

		{% if not p.is_image and not (p.url and p.url.lower().endswith('.mp4')) %}
		<div class="col-span-full">
			<div class="col">
				<a {% if not v or v.newtabexternal %}target="_blank"{% endif %} rel="nofollow noopener noreferrer" href="{{p.realurl(v)}}"></a>
			</div>
		</div>
		{% endif %}
	</div>

	<div class="col-span-full md:hidden">
		<div class="post-actions">
			<ul class="list-inline text-right d-flex">

				<li class="list-inline-item mr-auto">
					<a {% if v %}href="{{p.permalink}}"{% else %}href="/logged_out{{p.permalink}}"{% endif %}>
						<i class="fas fa-comment-dots"></i>{{p.comment_count}}
						<span class="text-info hidden new-comments"></span>
					</a>
				</li>

				<a class="list-inline-item copy-link" href="javascript:void(0);" role="button" data-clipboard-text="{% if 'rama' in request.host %}https://dogpill.life{{p.permalink}}{% else %}{{p.permalink | full_link}}{% endif %}"><i class="fas fa-link"></i>Copy link</a>
				{% if v %}
				<li class="list-inline-item">
					<a href="javascript:void(0)" data-bs-toggle="modal" data-bs-target="#actionsModal">
						<i class="fas fa-ellipsis-h"></i>
					</a>
				</li>
				{% endif %}
				<li id="voting-{{p.id}}-mobile" class="voting list-inline-item md:hidden{% if voted==1 %} upvoted{% elif voted==-1 %} downvoted{% endif %}">
					{% if v %}
					<span id="post-mobile-{{p.id}}-up" tabindex="0" href="javascript:void(0)" onclick="vote('post-mobile', '{{p.id}}', '1')" class="mx-0 pr-1 arrow-up upvote-button post-{{p.id}}-up {% if voted==1 %}active{% endif %}">
					</span>
					{% else %}
					<span id="arrow-{{p.id}}-mobile-up" tabindex="0" class="mx-0 pr-1 arrow-mobile-up" onclick="location.href='/login?redirect={{request.path | urlencode}}';">
						<i class="fas fa-arrow-alt-up mx-0" aria-hidden="true"></i>
					</span>
					{% endif %}

					<span id="post-mobile-score-{{p.id}}" class="score post-score-{{p.id}} {% if voted==1 %}score-up{% elif voted==-1%}score-down{% endif %}" data-bs-toggle="tooltip" data-bs-placement="top" title="" data-bs-original-title="+{{ups}} | -{{downs}}">{{score}}</span>

					{% if v %}
					<span {% if environ.get('DISABLE_DOWNVOTES') == '1' %}style="display:None!important"{% endif %} id="post-mobile-{{p.id}}-down" tabindex="0" href="javascript:void(0)" onclick="vote('post-mobile', '{{p.id}}', '-1')" class="mx-0 pl-1 my-0 arrow-down downvote-button post-{{p.id}}-down {% if voted==-1 %}active{% endif %}"></span>
					{% else %}
					<span {% if environ.get('DISABLE_DOWNVOTES') == '1' %}style="display:None!important"{% endif %} id="arrow-{{p.id}}-mobile-down" tabindex="0" class="arrow-mobile-down mx-0 pl-1 my-0" onclick="location.href='/login?redirect={{request.path | urlencode}}';">
						<i class="fas fa-arrow-alt-down mx-0" aria-hidden="true"></i>
					</span>
					{% endif %}
				</li>
			</ul>
		</div>
	</div>

	<div class="col-span-full shadow-inset-white-05 border-t border-black border-opacity-40 py-4">

			<!-- <div class="comments-count mb-4">
				<div class="dropdown dropdown-actions">
					<button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
						{% if sort=="top" %}<i class="fas fa-arrow-alt-circle-up mr-1"></i>{% endif %}
						{% if sort=="bottom" %}<i class="fas fa-arrow-alt-circle-down mr-1"></i>{% endif %}
						{% if sort=="new" %}<i class="fas fa-sparkles mr-1"></i>{% endif %}
						{% if sort=="old" %}<i class="fas fa-book mr-1"></i>{% endif %}
						{% if sort=="controversial" %}<i class="fas fa-bullhorn mr-1"></i>{% endif %}
						{{sort | capitalize}}
					</button>
					<div class="dropdown-menu" aria-labelledby="dropdownMenuButton" x-placement="bottom-start" style="position: absolute; will-change: transform; top: 0px; left: 0px; transform: translate3d(0px, 31px, 0px);">
						{% if sort != "top" %}<a class="dropdown-item" href="?sort=top"><i class="fas fa-arrow-alt-circle-up mr-2"></i>Top</a>{% endif %}
						{% if sort != "bottom" %}<a class="dropdown-item" href="?sort=bottom"><i class="fas fa-arrow-alt-circle-down mr-2"></i>Bottom</a>{% endif %}
						{% if sort != "new" %}<a class="dropdown-item" href="?sort=new"><i class="fas fa-sparkles mr-2"></i>New</a>{% endif %}
						{% if sort != "old" %}<a class="dropdown-item" href="?sort=old"><i class="fas fa-book mr-2"></i>Old</a>{% endif %}
						{% if sort != "controversial" %}<a class="dropdown-item" href="?sort=controversial"><i class="fas fa-bullhorn mr-2"></i>Controversial</a>{% endif %}
					</div>
					{% if linked_comment and p.comment_count >= 2%}
					<pre></pre>
					<div class="total"><a {% if v %}href="{{p.permalink}}"{% else %}href="/logged_out{{p.permalink}}"{% endif %}>View entire discussion</a></div>
					{% endif %}
				</div>
			</div> -->

			<div class="flex justify-between mb-2">
				<div class="ml-20 text-lg text-gray-200 font-bold font-heading">
					{{ p.comment_count }} {{ 'Comment' if p.comment_count == 1 else 'Comments' }}
				</div>
				<ul class="flex space-x-3 text-sm text-gray-500">
					<li>
						<a href="?sort=top" class="{% if sort == 'top' %}font-bold text-gray-200{% endif %}">
							Top
						</a>
					</li>
					<li>
						<a href="?sort=new" class="{% if sort == 'new' %}font-bold text-gray-200{% endif %}">
							Latest
						</a>
					</li>
					<li>
						<a href="?sort=old" class="{% if sort == 'old' %}font-bold text-gray-200{% endif %}">
							Oldest
						</a>
					</li>
					<li>
						<a href="?sort=controversial" class="{% if sort == 'controversial' %}font-bold text-gray-200{% endif %}">
							Controversial
						</a>
					</li>
					<li>
						<a href="?sort=bottom" class="{% if sort == 'bottom' %}font-bold text-gray-200{% endif %}">
							Worst
						</a>
					</li>
				</ul>
			</div>

			<div id="comment-form-space-{{p.fullname}}" class="comment-write flex">
				<img src="{{v.profile_url}}" class="w-16 h-16 object-cover rounded-sm mr-4" alt="my avatar"/>
				{% include "/comments/CommentForm.html" %}
			</div>

			{% if not v and not p.is_banned %}
			<div class="comment-write mb-3">
				<textarea maxlength="10000" class="comment-box rounded-sm border border-gray-700 border-opacity-40 bg-gray-700 bg-opacity-20 focus:bg-opacity-100 focus:bg-white hover:bg-opacity-30 shadow-inner w-full p-2" name="body" aria-label="With textarea" placeholder="Add your comment..." rows="3" onclick="location.href='/login?redirect={{request.path | urlencode}}';"></textarea>
			</div>
			{% if p.comment_count >= 2 %}
			<div class="card border-0 mt-4">
				<div class="card-body">
					<h5 class="card-title">Jump in the discussion.</h5>
					<p class="card-text">No email address required.</p>
					<div>
						<a href="/signup?redirect={{request.path | urlencode}}" class="btn btn-primary">Sign up</a>
						<a href="/login?redirect={{request.path | urlencode}}" class="btn btn-link text-muted">Sign in</a>
					</div>
				</div>
			</div>
			{% endif %}
			{% endif %}

			{% if p.replies %}
			<div class="comment-section {% if p.award_count('upsidedown') %}bg-transparent{% endif %}">
				{% with comments=p.replies %}
				{% include "comments.html" %}
				{% endwith %}
			</div>
			{% elif not p.replies and p.deleted_utc == 0 %}
			<div class="comment-section text-center py-7 {% if p.award_count('upsidedown') %}bg-transparent{% endif %}">
				<span class="fa-stack fa-2x text-muted mb-4">
					<i class="fas fa-square text-gray-500 opacity-25 fa-stack-2x"></i>
					<i class="fas text-gray-500 fa-ghost fa-stack-1x text-lg"></i>
				</span>
				<h2 class="h5">Be the first to comment!</h2>
				{% if v %}
				<p class="text-muted">This comment section is a ghost town...</p>
				{% else %}
				<p class="text-muted">This comment section is a ghost town. <a href="/login?redirect={{request.path | urlencode}}">Sign in</a></p>
				{% endif %}
			</div>
			{% endif %}

	</div>

	<script>
		(() => {
			const date = new Date({{p.created_utc*1000}});
			document.getElementById('timestamp').title = date.toString();
			{% if p.edited_utc %}
			const dateEdited = new Date({{p.edited_utc*1000}});
			document.getElementById('edited_timestamp').title = dateEdited.toString();
			{% endif %}

			{% if (not v or v.highlightcomments) %}
			showNewCommentCounts('{{p.id}}', {{p.comment_count}})
			{% endif %}

			{% if "?context" not in request.full_path %}
			const comments = JSON.parse(localStorage.getItem("comment-counts")) || {}
			const newTotal = {{p.comment_count}} || ((comments['{{p.id}}'] || { c: 0 }).c + 1)
			comments['{{p.id}}'] = { c: newTotal, t: Date.now() }
			window.localStorage.setItem("comment-counts", JSON.stringify(comments))
			{% endif %}

			{% if p.stickied %}
			const pinned_info = document.getElementById('pinned-{{p.id}}')
			{% if p.stickied.startswith('t:') %}
			pinned_info.setAttribute("data-bs-original-title", `Pinned until ${new Date({{p.stickied[2:]}} * 1000).toString()}`)
				{% else %}
				pinned_info.setAttribute("data-bs-original-title", "Pinned by @{{p.stickied}}")
				{%endif%}
				{%endif%}
			})()
		</script>

		{% if v and v.id==p.author_id %}
		{% include "delete_post_modal.html" %}
		{% endif %}

		{% if v %}
		{% include "report_post_modal.html" %}
		{% endif %}

	</div>

		{% endblock %}

<!-- Sidebar -->
{% block sidebar %}
<div class="hidden xl:block xl:col-start-10 xl:col-end-13 flex-shrink-0 py-4">
	<div>
		<h2 class="font-bold text-xl font-heading leading-normal pb-2 mb-2 border-b-2 border-gray-800">
			DramaMeter™
		</h2>
		<!-- Icons -->
		<ul class="flex space-x-2 items-center mb-3">
			<!-- Awards -->
			{% if p.awards %}
			{% for a in p.awards %}
			<li>
				<i class="{{a.class_list}}" data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-original-title="{{a.title}} Award given by @{{a.user.username}}"></i>
			</li>
			{% endfor %}
			{% endif %}
			<!-- Banned -->
			{% if p.bannedfor and p.author.banned_by %}
			<li>
				<i class="fad fa-gavel text-danger" data-bs-toggle="tooltip" data-bs-placement="bottom" title="" data-bs-original-title="User was banned for this post by @{{p.author.banned_by.username}}"></i>
			</li>
			{% endif %}	
			<!-- Stickied -->
			{% if p.stickied %}
			<li>
				<i id="pinned-{{p.id}}" class="fas fa-thumbtack fa-rotate--45 fa-fw text-admin" data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-original-title="Pinned {% if p.stickied.startswith('t:') %}until {{p.stickied[2:]}}{% else %}by @{{p.stickied}}{%endif%}"></i>
			</li>
			{% endif %}
			<!-- Pinned -->
			{% if p.is_pinned %}
			<li>
				<i class="fas fa-thumbtack fa-rotate--45 fa-fw text-admin" data-bs-toggle="tooltip" data-bs-placement="bottom"data-bs-original-title="Pinned to profile"></i>
			</li>
			{% endif %}
			<!-- NSFW -->
			{% if p.over_18 %}
			<li>
				<span class="px-2 py-1 rounded-sm bg-gradient-to-t from-red-700 to-red-500 shadow-inner text-xs text-white">+18</span>
			</li>
			{% endif %}
			<!-- Private -->
			{% if p.private %}
			<li>
				<span class="badge border-warning border-1 text-small-extra">Draft</span>
			</li>
			{% endif %}
		</ul>
	</div>
</div>
{% endblock %}